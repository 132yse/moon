/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var c=function(e,t,n){for(;e<n;){var r=t[e],i=t[e+1],u=t[e+2];if("<"===r&&"!"===i&&"-"===u&&"-"===t[e+3])e=c(e+4,t,n);else{if("-"===r&&"-"===i&&">"===u){e+=3;break}e+=1}}return e},a=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,m=function(e,t,n){for(var r,i=!1;null!==(r=a.exec(e));){var u=r[1];void 0!==u&&-1===n.indexOf(u)&&(t.push(u),i=!0)}return i},e={silent:!0},s=function(e,t){t[t.length-1].children.push(e)},v=/\s/,d=function(e,t,n,r,i,u){for(;e<n;){var a=t[e];if("/"===a||">"===a)break;if(v.test(a))e+=1;else{for(var o="",c="",f="",s=!1;e<n;){if("/"===(a=t[e])||">"===a||v.test(a)){f=o;break}if("="===a){e+=1;break}":"===a&&"m"===o[0]&&"-"===o[1]?(c+=t[e+1],e+=2):(0!==c.length?c+=a:o+=a,e+=1)}if(0===f.length){var d=void 0;for('"'===(a=t[e])||"'"===a?(d=a,e+=1):"{"===a?(d="}",s=!0,e+=1):d=v;e<n&&"/"!==(a=t[e])&&">"!==a;){if("object"==typeof d&&d.test(a)||a===d){e+=1;break}f+=a,e+=1}}r.push({key:o,value:f,argument:c,expression:s,dynamic:s&&m(f,i,u)})}}return e},f=function(e,t,n,r,i,u){for(var a="",o=[];e<n;){var c=t[e];if(">"===c){var f={index:r.parseIndex++,type:a,attributes:o,children:[]};s(f,r),r.push(f),e+=1;break}if("/"===c&&">"===t[e+1]){s({index:r.parseIndex++,type:a,attributes:o,children:[]},r),e+=2;break}v.test(c)?e=d(e+1,t,n,o=[],i,u):(a+=c,e+=1)}return e},p=function(e,t,n,r){for(;e<n;e++){var i=t[e];if(">"===i){e+=1;break}i}var u=r.pop();return u.type,e},o=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,h={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},l=function(e,t,n,r){for(var i="";e<n;e++){var u=t[e];if("<"===u||"{"===u)break;i+=u}return s({index:r.parseIndex++,type:"m-text",content:i.replace(o,function(e){return h[e]})},r),e},x=function(e,t,n,r,i,u){for(var a="";e<n;e++){var o=t[e];if("}"===o){e+=1;break}a+=o}return s({index:r.parseIndex++,type:"m-expression",content:a,dynamic:m(a,i,u)},r),e},i=function(e,n){return e.reduce(function(e,t){return e+n(t)},"")},r=function(e){return e.expression?e.value:'"'+e.value+'"'},u=function(e){switch(e.type){case"m-fragment":return i(e.children,u);case"m-expression":return"m["+e.index+"]=m.ct("+e.content+");";case"m-text":return"m["+e.index+']=m.ct("'+e.content+'");';default:return i(e.children,u)+"m["+e.index+']=m.ce("'+e.type+'");'+i((n=e).attributes,function(e){var t=e.key;switch(t){case"m-for":case"m-if":break;case"m-on":return"m["+n.index+'].addEventListener("'+e.argument+'", function(event){'+r(e)+"});";default:return"m["+n.index+'].setAttribute("'+t+'",'+r(e)+");"}})}var n},b=function(e,t){var n="";switch(e.type){case"m-fragment":return i(e.children,function(e){return b(e,t)});default:var r="m["+e.index+"]";"m-text"!==e.type&&"m-expression"!==e.type&&(n+=i(e.children,function(e){return b(e,r)})),n+="m.ma("+r+","+t+");"}return n},y=function(e){switch(e.type){case"m-expression":return e.dynamic?"m.ut(m["+e.index+"],"+e.content+");":"";case"m-text":return"";default:return i((n=e).attributes,function(e){if(!e.dynamic)return"";var t=e.key;switch(t){case"m-for":case"m-if":break;case"m-on":return"";default:return"m["+n.index+'].setAttribute("'+t+'",'+e.value+");"}})+i(e.children,y)}var n},w=function(e){return t=function(e){for(var t=e.length,n=[],r=["NaN","event","false","in","null","this","true","typeof","undefined"],i={type:"m-fragment",attributes:[],children:[],dependencies:n},u=[i],a=u.parseIndex=0;a<t;){var o=e[a];a="<"===o?"!"===e[a+1]&&"-"===e[a+2]&&"-"===e[a+3]?c(a+4,e,t):"/"===e[a+1]?p(a+2,e,t,u):f(a+1,e,t,u,n,r):"{"===o?x(a+1,e,t,u,n,r):l(a,e,t,u)}return i}(e),n="var m=this.m;"+i(t.dependencies,function(e){return"var "+e+"=this.data."+e+";"}),new Function("return [function(){"+n+u(t)+"},function(root){var m=this.m;"+b(t,"root")+"},function(){"+n+y(t)+"}]")();var t,n},g={},k=function(e){return document.createElement(e)},q=function(e){return document.createTextNode(e)},A=function(e,t){t.appendChild(e)},I=function(e,t){e.textContent=t},z=function(){if(!1===this.queued){this.queued=!0;var e=this;setTimeout(function(){e.view[2](),e.queued=!1},0)}},Z=function(e,t){if("object"==typeof e)for(var n in e)this.set(n,e[n]);else this.data[e]=t,this.build()},$=function(u,a){return function(){var e,t=this;this.name=u,this.view=a.view.map(function(e){return e.bind(t)}),this.m=((e=[]).c=g,e.ce=k,e.ct=q,e.ma=A,e.ut=I,e);var n=this.data=a.data(),r=a.actions;for(var i in r)n[i]=r[i].bind(t);this.queued=!1,this.build=z,this.set=Z}};function t(e){var t=e.root;"string"==typeof t&&(t=document.querySelector(t));var n=e.view;"string"==typeof n&&(e.view=w(n));var r=e.data;void 0===r?e.data=function(){return{}}:"object"==typeof r&&(e.data=function(){return r}),void 0===e.actions&&(e.actions={});var i=new($("m-root",e));return i.view[0](),i.view[1](t),i}return t.extend=function(e,t){var n=t.view;"string"==typeof n&&(t.view=w(n)),void 0===t.data&&(t.data=function(){return{}}),void 0===t.actions&&(t.actions={}),g[e]=$(e,t)},t.compile=w,t.config=e,t});