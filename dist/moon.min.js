/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(t,e){"undefined"==typeof module?t.Moon=e():module.exports=e()}(this,function(){"use strict";var c=function(t,e,n){for(;t<n;){var i=e[t],r=e[t+1],u=e[t+2];if("<"===i&&"!"===r&&"-"===u&&"-"===e[t+3])t=c(t+4,e,n);else{if("-"===i&&"-"===r&&">"===u){t+=3;break}t+=1}}return t},a=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,m=function(t,e,n){for(var i,r=!1;null!==(i=a.exec(t));){var u=i[1];void 0!==u&&-1===n.indexOf(u)&&(e.push(u),r=!0)}return r},t={silent:!0},s=function(t,e){e[e.length-1].children.push(t)},p=/\s/,v=function(t,e,n,i,r,u,a){for(;t<n;){var o=e[t];if("/"===o||">"===o)break;if(p.test(o))t+=1;else{for(var c="",f="",d="",s=!1;t<n;){if("/"===(o=e[t])||">"===o||p.test(o)){d=c;break}if("="===o){t+=1;break}":"===o&&"m"===c[0]&&"-"===c[1]?(f+=e[t+1],t+=2):(0!==f.length?f+=o:c+=o,t+=1)}if(0===d.length){var v=void 0;for('"'===(o=e[t])||"'"===o?(v=o,t+=1):"{"===o?(v="}",s=!0,t+=1):v=p;t<n&&"/"!==(o=e[t])&&">"!==o;){if("object"==typeof v&&v.test(o)||o===v){t+=1;break}d+=o,t+=1}}("m"===c[0]&&"-"===c[1]?r:i).push({key:c,value:d,argument:f,expression:s,dynamic:s&&m(d,u,a)})}}return t},f=function(t,e,n,i,r,u){for(var a="",o=[],c=[];t<n;){var f=e[t];if(">"===f){var d={index:i.parseIndex++,type:a,attributes:o,directives:c,children:[]};s(d,i),i.push(d),t+=1;break}if("/"===f&&">"===e[t+1]){s({index:i.parseIndex++,type:a,attributes:o,directives:c,children:[]},i),t+=2;break}p.test(f)?t=v(t+1,e,n,o=[],c=[],r,u):(a+=f,t+=1)}return t},d=function(t,e,n,i){for(;t<n;t++){var r=e[t];if(">"===r){t+=1;break}r}var u=i.pop();return u.type,t},o=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,h={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},l=function(t,e,n,i){for(var r="";t<n;t++){var u=e[t];if("<"===u||"{"===u)break;r+=u}return s({index:i.parseIndex++,type:"m-text",content:r.replace(o,function(t){return h[t]})},i),t},x=function(t,e,n,i,r,u){for(var a="";t<n;t++){var o=e[t];if("}"===o){t+=1;break}a+=o}return s({index:i.parseIndex++,type:"m-expression",content:a,dynamic:m(a,r,u)},i),t},y=function(t,n){return t.reduce(function(t,e){return t+n(e)},"")},b=function(t){return t.expression?t.value:'"'+t.value+'"'},g={"m-on":{create:function(t,e,n){return t+"m["+n.index+'].addEventListener("'+e.argument+'", function(event){'+b(e)+";});"},update:function(){}}},w=function(e,n){switch(e.type){case"m-fragment":return y(e.children,function(t){return w(t,n)});case"m-expression":return"m["+e.index+"]=m.ct("+e.content+");m.ca(m["+e.index+"],"+n+");";case"m-text":return"m["+e.index+']=m.ct("'+e.content+'");m.ca(m['+e.index+"],"+n+");";default:for(var t=e.directives,i="m["+e.index+']=m.ce("'+e.type+'");'+y(e.attributes,function(t){return"m["+e.index+'].setAttribute("'+t.key+'",'+b(t)+");"})+"m.ca(m["+e.index+"], "+n+");"+y(e.children,function(t){return w(t,"m["+e.index+"]")}),r=0;r<t.length;r++){var u=t[r];i=g[u.key].create(i,u,e,n)}return i}},i=function(e){switch(e.type){case"m-expression":return e.dynamic?"m.ut(m["+e.index+"],"+e.content+");":"";case"m-text":return"";default:return y(e.attributes,function(t){return t.dynamic?"m["+e.index+'].setAttribute("'+t.key+'",'+t.value+");":""})+y(e.children,i)}},u=function(t){return e=function(t){for(var e=t.length,n=[],i=["NaN","event","false","in","null","this","true","typeof","undefined"],r={type:"m-fragment",attributes:[],directives:[],children:[],dependencies:n},u=[r],a=u.parseIndex=0;a<e;){var o=t[a];a="<"===o?"!"===t[a+1]&&"-"===t[a+2]&&"-"===t[a+3]?c(a+4,t,e):"/"===t[a+1]?d(a+2,t,e,u):f(a+1,t,e,u,n,i):"{"===o?x(a+1,t,e,u,n,i):l(a,t,e,u)}return r}(t),n="var m=this.m;"+y(e.dependencies,function(t){return"var "+t+"=this.data."+t+";"}),new Function("return [function(root){"+n+w(e,"root")+"},function(){"+n+i(e)+"}]")();var e,n},k={},q=function(t){return document.createElement(t)},A=function(t){return document.createTextNode(t)},I=function(t,e){e.appendChild(t)},z=function(t,e){t.textContent=e},Z=function(){if(!1===this.queued){this.queued=!0;var t=this;setTimeout(function(){t.view[1](),t.queued=!1,t.emit("updated")},0)}},$=function(t,e){if("object"==typeof t)for(var n in t)this.set(n,t[n]);else this.data[t]=e,this.build()},_=function(t,e){var n=this.data,i=n[t];void 0===i?n[t]=e:"function"==typeof i?n[t]=[i,e]:i.push(e)},j=function(t,e){if(void 0===e)this.data[t]=[];else{var n=this.data,i=n[t];"function"==typeof i?n[t]=void 0:i.splice(i.indexOf(e),1)}},N=function(t,e){var n=this.data[t];if(void 0!==n)if("function"==typeof n)n(e);else for(var i=0;i<n.length;i++)n[i](e)},C=function(u,a){return function(){var t,e=this;this.name=u,this.view=a.view.map(function(t){return t.bind(e)}),this.m=((t=[]).c=k,t.ce=q,t.ct=A,t.ca=I,t.ut=z,t);var n=this.data=a.data(),i=a.actions;for(var r in i)n[r]=i[r].bind(e);this.queued=!1,this.build=Z,this.set=$,this.on=_,this.off=j,this.emit=N}};function e(t){var e=t.root;"string"==typeof e&&(e=document.querySelector(e));var n=t.view;"string"==typeof n&&(t.view=u(n));var i=t.data;void 0===i?t.data=function(){return{}}:"object"==typeof i&&(t.data=function(){return i}),void 0===t.actions&&(t.actions={});var r=new(C("m-root",t));return r.view[0](e),r.emit("created"),r}return e.extend=function(t,e){var n=e.view;"string"==typeof n&&(e.view=u(n)),void 0===e.data&&(e.data=function(){return{}}),void 0===e.actions&&(e.actions={}),k[t]=C(t,e)},e.compile=u,e.config=t,e});