/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var c=function(e,t,n){for(;e<n;){var i=t[e],r=t[e+1],u=t[e+2];if("<"===i&&"!"===r&&"-"===u&&"-"===t[e+3])e=c(e+4,t,n);else{if("-"===i&&"-"===r&&">"===u){e+=3;break}e+=1}}return e},u=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,a=["NaN","event","false","in","m","null","this","true","typeof","undefined"],m=function(e,t){for(var n,i=!1;null!==(n=u.exec(e));){var r=n[1];void 0!==r&&-1===t.indexOf(r)&&-1===a.indexOf(r)&&"$"!==r[0]&&(t.push(r),i=!0)}return i},e={silent:!0},v=/\s+/,d=function(e,t){t[t.length-1].children.push(e)},s=function(e,t,n,i,r,u){for(;e<n;){var a=t[e];if("/"===a||">"===a)break;if(v.test(a))e+=1;else{for(var c="",o="",f="",d=!1;e<n;){if("/"===(a=t[e])||">"===a||v.test(a)){f=c;break}if("="===a){e+=1;break}":"===a&&"m"===c[0]&&"-"===c[1]?(o+=t[e+1],e+=2):(0!==o.length?o+=a:c+=a,e+=1)}if(0===f.length){var s=void 0;for('"'===(a=t[e])||"'"===a?(s=a,e+=1):"{"===a?(s="}",d=!0,e+=1):s=v;e<n&&"/"!==(a=t[e])&&">"!==a;){if("object"==typeof s&&s.test(a)||a===s){e+=1;break}f+=a,e+=1}}("m"===c[0]&&"-"===c[1]?r:i).push({key:c,value:f,argument:o,expression:d,dynamic:d&&m(f,u)})}}return e},o=function(e,t,n,i,r){for(var u="",a=[],c=[];e<n;){var o=t[e];if(">"===o){var f={index:i[0].nextIndex++,type:u,attributes:a,directives:c,children:[]};d(f,i),i.push(f),e+=1;break}if("/"===o&&">"===t[e+1]){d({index:i[0].nextIndex++,type:u,attributes:a,directives:c,children:[]},i),e+=2;break}v.test(o)?e=s(e+1,t,n,a=[],c=[],r):(u+=o,e+=1)}return e},f=function(e,t,n,i){for(;e<n;e++){var r=t[e];if(">"===r){e+=1;break}r}var u=i.pop();return u.type,e},h=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,p={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},l=function(e,t,n,i){for(var r="";e<n;e++){var u=t[e];if("<"===u||"{"===u)break;r+=u}return v.test(r)||d({index:i[0].nextIndex++,type:"m-text",content:r.replace(h,function(e){return p[e]})},i),e},x=function(e,t,n,i,r){for(var u="";e<n;e++){var a=t[e];if("}"===a){e+=1;break}u+=a}return d({index:i[0].nextIndex++,type:"m-expression",content:u,dynamic:m(u,r)},i),e},y=function(e,n){return e.reduce(function(e,t){return e+n(t)},"")},b=function(e){return e.expression?e.value:'"'+e.value+'"'},g={"m-on":{create:function(e,t,n,i,r,u,a){return i.on=a.nextIndex++,e+"m.ael(m["+r.index+'],"'+i.argument+'",function($event){m['+i.on+"]($event);});"},mount:function(e){return e},update:function(e,t,n,i){return e+"m["+i.on+"]=function($event){"+b(i)+";};"}}},w=function(t,n,i){switch(t.type){case"m-fragment":return y(t.children,function(e){return w(e,n,i)});case"m-expression":return"m["+t.index+']=m.ctn("");';case"m-text":return"m["+t.index+']=m.ctn("'+t.content+'");';default:for(var e=t.directives,r="m["+t.index+']=m.ce("'+t.type+'");'+y(t.attributes,function(e){return e.dynamic?"":"m.sa(m["+t.index+'],"'+e.key+'",'+b(e)+")"}),u=y(t.children,function(e){return w(e,t,i)}),a=r+u,c=0;c<e.length;c++){var o=e[c];a=g[o.key].create(a,r,u,o,t,n,i)}return a}},k=function(t,n,i){switch(t.type){case"m-fragment":return y(t.children,function(e){return k(e,n,i)});case"m-expression":case"m-text":return"m.ac(m["+t.index+"],m["+n.index+"]);";default:for(var e=t.directives,r="m.ac(m["+t.index+"],m["+n.index+"]);",u=y(t.children,function(e){return k(e,t,i)}),a=r+u,c=0;c<e.length;c++){var o=e[c],f=g[o.key];a=f.mount(a,r,u,o,t,n,i),o.dynamic||(a+=f.update("","","",o,t,n,i))}return a}},$=function(t,n,i){switch(t.type){case"m-fragment":return y(t.children,function(e){return $(e,n,i)});case"m-expression":return t.dynamic?"m.stc(m["+t.index+"],"+t.content+");":"";case"m-text":return"";default:for(var e=t.directives,r=y(t.attributes,function(e){return e.dynamic?"m.sa(m["+t.index+'],"'+e.key+'",'+e.value+");":""}),u=y(t.children,function(e){return $(e,t,i)}),a=r+u,c=0;c<e.length;c++){var o=e[c];o.dynamic&&(a=g[o.key].update(a,r,u,o,t,n,i))}return a}},q=function(e){return t=function(e){for(var t=e.length,n=[],i={index:0,nextIndex:1,type:"m-root",attributes:[],directives:[],children:[],dependencies:n},r=[i],u=0;u<t;){var a=e[u];u="<"===a?"!"===e[u+1]&&"-"===e[u+2]&&"-"===e[u+3]?c(u+4,e,t):"/"===e[u+1]?f(u+2,e,t,r):o(u+1,e,t,r,n):"{"===a?x(u+1,e,t,r,n):l(u,e,t,r)}return i}(e),new Function("return [function(m){this.m[0]=m;m=this.m;"+y(t.children,function(e){return w(e,t,t)})+y(t.children,function(e){return k(e,t,t)})+"},function(){var m=this.m;"+y(t.dependencies,function(e){return"var "+e+"=this.data."+e+";"})+y(t.children,function(e){return $(e,t,t)})+"}]")();var t},I={},A=function(e){return document.createElement(e)},z=function(e){return document.createTextNode(e)},Z=function(e,t){t.appendChild(e)},_=function(e,t,n){n.replaceChild(e,t)},j=function(e,t,n){e.addEventListener(t,n)},C=function(e,t,n){e.setAttribute(t,n)},N=function(e,t){e.textContent=t},O=function(e){this.view[0](e),this.emit("created")},E=function(){if(!1===this.queued){this.queued=!0;var e=this;setTimeout(function(){e.view[1](),e.queued=!1,e.emit("updated")},0)}},T=function(e,t){if("object"==typeof e)for(var n in e)this.set(n,e[n]);else this.data[e]=t,this.update()},F=function(e,t){var n=this.data,i=n[e];void 0===i?n[e]=t:"function"==typeof i?n[e]=[i,t]:i.push(t)},L=function(e,t){if(void 0===t)this.data[e]=[];else{var n=this.data,i=n[e];"function"==typeof i?n[e]=void 0:i.splice(i.indexOf(t),1)}},M=function(e,t){var n=this.data[e];if(void 0!==n)if("function"==typeof n)n(t);else for(var i=0;i<n.length;i++)n[i](t)},S=function(u,a){return function(){var e,t=this;this.name=u,this.view=a.view.map(function(e){return e.bind(t)}),this.m=((e=[]).c=I,e.ce=A,e.ctn=z,e.ac=Z,e.rc=_,e.ael=j,e.sa=C,e.stc=N,e);var n=this.data=a.data(),i=a.actions;for(var r in i)n[r]=i[r].bind(t);this.queued=!1,this.create=O,this.update=E,this.set=T,this.on=F,this.off=L,this.emit=M}};function t(e){var t=e.root;"string"==typeof t&&(t=document.querySelector(t));var n=e.view;"string"==typeof n&&(e.view=q(n));var i=e.data;void 0===i?e.data=function(){return{}}:"object"==typeof i&&(e.data=function(){return i}),void 0===e.actions&&(e.actions={});var r=new(S("m-instance",e));return r.create(t),r.update(),r}return t.extend=function(e,t){var n=t.view;"string"==typeof n&&(t.view=q(n)),void 0===t.data&&(t.data=function(){return{}}),void 0===t.actions&&(t.actions={}),I[e]=S(e,t)},t.compile=q,t.config=e,t});