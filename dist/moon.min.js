/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(t,e){"undefined"==typeof module?t.Moon=e():module.exports=e()}(this,function(){"use strict";var c=function(t,e,n){for(;t<n;){var r=e[t],i=e[t+1],a=e[t+2];if("<"===r&&"!"===i&&"-"===a&&"-"===e[t+3])t=c(t+4,e,n);else{if("-"===r&&"-"===i&&">"===a){t+=3;break}t+=1}}return t},u=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,v=function(t,e,n){for(var r,i=!1;null!==(r=u.exec(t));){var a=r[1];void 0!==a&&-1===n.indexOf(a)&&(e.push(a),i=!0)}return i},t={silent:!0},s=function(t,e){e[e.length-1].children.push(t)},m=/\s/,d=function(t,e,n,r,i,a){for(;t<n;){var u=e[t];if("/"===u||">"===u)break;if(m.test(u))t+=1;else{for(var o="",c="",f="",s=!1;t<n;){if("/"===(u=e[t])||">"===u||m.test(u)){f=o;break}if("="===u){t+=1;break}":"===u&&"m"===o[0]&&"-"===o[1]?(c+=e[t+1],t+=2):(0!==c.length?c+=u:o+=u,t+=1)}if(0===f.length){var d=void 0;for('"'===(u=e[t])||"'"===u?(d=u,t+=1):"{"===u?(d="}",s=!0,t+=1):d=m;t<n&&"/"!==(u=e[t])&&">"!==u;){if("object"==typeof d&&d.test(u)||u===d){t+=1;break}f+=u,t+=1}}r.push({key:o,value:f,argument:c,expression:s,dynamic:s&&v(f,i,a)})}}return t},f=function(t,e,n,r,i,a){for(var u="",o=[];t<n;){var c=e[t];if(">"===c){var f={index:r.parseIndex++,type:u,attributes:o,children:[]};s(f,r),r.push(f),t+=1;break}if("/"===c&&">"===e[t+1]){s({index:r.parseIndex++,type:u,attributes:o,children:[]},r),t+=2;break}m.test(c)?t=d(t+1,e,n,o=[],i,a):(u+=c,t+=1)}return t},p=function(t,e,n,r){for(;t<n;t++){var i=e[t];if(">"===i){t+=1;break}i}var a=r.pop();return a.type,t},o=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,h={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},l=function(t,e,n,r){for(var i="";t<n;t++){var a=e[t];if("<"===a||"{"===a)break;i+=a}return s({index:r.parseIndex++,type:"m-text",content:i.replace(o,function(t){return h[t]})},r),t},x=function(t,e,n,r,i,a){for(var u="";t<n;t++){var o=e[t];if("}"===o){t+=1;break}u+=o}return s({index:r.parseIndex++,type:"m-expression",content:u,dynamic:v(u,i,a)},r),t},i=function(t,n){return t.reduce(function(t,e){return t+n(e)},"")},a=function(t){return t.expression?t.value:'"'+t.value+'"'},b=function(e,n){switch(e.type){case"m-fragment":return i(e.children,function(t){return b(t,n)});case"m-expression":return"m["+e.index+"]=m.ct("+e.content+");m.ca(m["+e.index+"],"+n+");";case"m-text":return"m["+e.index+']=m.ct("'+e.content+'");m.ca(m['+e.index+"],"+n+");";default:return"m["+e.index+']=m.ce("'+e.type+'");'+i((r=e).attributes,function(t){var e=t.key;switch(e){case"m-for":case"m-if":break;case"m-on":return"m["+r.index+'].addEventListener("'+t.argument+'", function(event){'+a(t)+"});";default:return"m["+r.index+'].setAttribute("'+e+'",'+a(t)+");"}})+"m.ca(m["+e.index+"], "+n+");"+i(e.children,function(t){return b(t,"m["+e.index+"]")})}var r},r=function(t){switch(t.type){case"m-expression":return t.dynamic?"m.ut(m["+t.index+"],"+t.content+");":"";case"m-text":return"";default:return i((n=t).attributes,function(t){if(!t.dynamic)return"";var e=t.key;switch(e){case"m-for":case"m-if":break;case"m-on":return"";default:return"m["+n.index+'].setAttribute("'+e+'",'+t.value+");"}})+i(t.children,r)}var n},y=function(t){return e=function(t){for(var e=t.length,n=[],r=["NaN","event","false","in","null","this","true","typeof","undefined"],i={type:"m-fragment",attributes:[],children:[],dependencies:n},a=[i],u=a.parseIndex=0;u<e;){var o=t[u];u="<"===o?"!"===t[u+1]&&"-"===t[u+2]&&"-"===t[u+3]?c(u+4,t,e):"/"===t[u+1]?p(u+2,t,e,a):f(u+1,t,e,a,n,r):"{"===o?x(u+1,t,e,a,n,r):l(u,t,e,a)}return i}(t),n="var m=this.m;"+i(e.dependencies,function(t){return"var "+t+"=this.data."+t+";"}),new Function("return [function(root){"+n+b(e,"root")+"},function(){"+n+r(e)+"}]")();var e,n},w={},g=function(t){return document.createElement(t)},k=function(t){return document.createTextNode(t)},q=function(t,e){e.appendChild(t)},A=function(t,e){t.textContent=e},I=function(){if(!1===this.queued){this.queued=!0;var t=this;setTimeout(function(){t.view[1](),t.queued=!1,t.emit("updated")},0)}},z=function(t,e){if("object"==typeof t)for(var n in t)this.set(n,t[n]);else this.data[t]=e,this.build()},Z=function(t,e){var n=this.data,r=n[t];void 0===r?n[t]=e:"function"==typeof r?n[t]=[r,e]:r.push(e)},$=function(t,e){if(void 0===e)this.data[t]=[];else{var n=this.data,r=n[t];"function"==typeof r?n[t]=void 0:r.splice(r.indexOf(e),1)}},_=function(t,e){var n=this.data[t];if(void 0!==n)if("function"==typeof n)n(e);else for(var r=0;r<n.length;r++)n[r](e)},j=function(a,u){return function(){var t,e=this;this.name=a,this.view=u.view.map(function(t){return t.bind(e)}),this.m=((t=[]).c=w,t.ce=g,t.ct=k,t.ca=q,t.ut=A,t);var n=this.data=u.data(),r=u.actions;for(var i in r)n[i]=r[i].bind(e);this.queued=!1,this.build=I,this.set=z,this.on=Z,this.off=$,this.emit=_}};function e(t){var e=t.root;"string"==typeof e&&(e=document.querySelector(e));var n=t.view;"string"==typeof n&&(t.view=y(n));var r=t.data;void 0===r?t.data=function(){return{}}:"object"==typeof r&&(t.data=function(){return r}),void 0===t.actions&&(t.actions={});var i=new(j("m-root",t));return i.view[0](e),i.emit("created"),i}return e.extend=function(t,e){var n=e.view;"string"==typeof n&&(e.view=y(n)),void 0===e.data&&(e.data=function(){return{}}),void 0===e.actions&&(e.actions={}),w[t]=j(t,e)},e.compile=y,e.config=t,e});