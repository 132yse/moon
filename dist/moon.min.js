/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var a=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,u=["NaN","event","false","in","m","null","this","true","typeof","undefined"],s=function(e,t){for(var n,i=!1;null!==(n=a.exec(e));){var r=n[1];void 0!==r&&-1===u.indexOf(r)&&"$"!==r[0]&&(i=!0,-1===t.indexOf(r)&&t.push(r))}return i},e={silent:!0},d=/^\s+$/,l=function(e,t,n,i,r){for(;e<n;){var a=t[e];if("/"===a||">"===a)break;if(d.test(a))e+=1;else{for(var u="",c="",f=!1;e<n;){if("/"===(a=t[e])||">"===a||d.test(a)){c=u;break}if("="===a){e+=1;break}u+=a,e+=1}if(0===c.length){var o=void 0;for('"'===(a=t[e])||"'"===a?(o=a,e+=1):"{"===a?(o="}",f=!0,e+=1):o=d;e<n&&"/"!==(a=t[e])&&">"!==a;){if("object"==typeof o&&o.test(a)||a===o){e+=1;break}c+=a,e+=1}}r.push({key:u,value:c,expression:f,dynamic:f&&s(c,i)})}}return e},c=function(e,t,n,i,r){for(var a={type:"",attributes:[],children:[]};e<n;){var u=t[e];if(">"===u){var c=a.attributes;"#"!==a.type[0]&&(a.index=i[0].nextIndex++),i.push(a);for(var f=0;f<c.length;){var o=c[f];"#"===o.key[0]?(a={type:o.key,attributes:[{key:"",value:o.value,expression:o.expression,dynamic:o.dynamic}],children:[a]},c.splice(f,1)):f+=1}i[i.length-2].children.push(a),e+=1;break}if("/"===u&&">"===t[e+1]){"#"!==a.type[0]&&(a.index=i[0].nextIndex++),i[i.length-1].children.push(a),e+=2;break}d.test(u)&&(e+=1)||"="===u?e=l(e,t,n,r,a.attributes):(a.type+=u,e+=1)}return e},f=function(e,t,n,i){for(;e<n;e++){var r=t[e];if(">"===r){e+=1;break}r}var a=i.pop();return a.type,e},o=function(e,t,n){for(;e<n;){var i=t[e],r=t[e+1],a=t[e+2];if("<"===i&&"!"===r&&"-"===a&&"-"===t[e+3])e=o(e+4,t,n);else{if("-"===i&&"-"===r&&">"===a){e+=3;break}e+=1}}return e},v=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,h={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},m=function(e,t,n,i){for(var r="";e<n;e++){var a=t[e];if("<"===a||"{"===a)break;r+=a}return d.test(r)||i[i.length-1].children.push({type:"#text",attributes:[{key:"",value:r.replace(v,function(e){return h[e]}),expression:!1,dynamic:!1}],children:[]}),e},p=function(e,t,n,i,r){for(var a="";e<n;e++){var u=t[e];if("}"===u){e+=1;break}a+=u}return i[i.length-1].children.push({type:"#text",attributes:[{key:"",value:a,expression:!0,dynamic:s(a,r)}],children:[]}),e},x=function(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i]);return n},y=function(e){return"m["+e+"]"},b=function(e,t){return y(e)+"="+t},k=function(e){return e.expression?e.value:'"'+e.value+'"'},g=function(e,t){return"m.sa("+y(e)+',"'+t.key+'",'+k(t)+");"},i=function(e,t){return"m.rc("+y(e)+","+y(t)+");"},w=function(e,t,n){return void 0===n?(a=t,"m.ac("+y(e)+","+y(a)+");"):(i=n,r=t,"m.ib("+y(e)+","+y(i)+","+y(r)+");");var i,r,a},R=function(i,e,t,n){switch(i.type){case"#if":var r=e.children,a=r.indexOf(i)+1,u=r[a];return i.ifReference=t.nextIndex++,i.ifState=t.nextIndex++,i.ifCreate=R(i.children[0],e,t,i.ifReference),void 0!==u&&"#else"===u.type?(u.ifState=i.ifState,u.ifReference=i.ifReference):r.splice(a,0,{type:"#else",attributes:[],children:[{type:"#comment",attributes:[],children:[]}],ifState:i.ifState,ifReference:i.ifReference}),b(i.ifReference,"m.cc();")+w(i.ifReference,e.index,n);case"#else":return i.ifCreate=R(i.children[0],e,t,i.ifReference),"";case"#comment":return i.commentElement=t.nextIndex++,b(i.commentElement,"m.cc();");case"#text":var c=i.attributes[0];return i.textElement=t.nextIndex++,b(i.textElement,"m.ctn("+(c.dynamic?'""':k(c))+");")+w(i.textElement,e.index,n);default:return b(i.index,'m.ce("'+i.type+'");')+x(i.attributes,function(e){return"@"===e.key[0]?(t=i.index,n=e,"m.ael("+y(t)+',"'+n.key.substring(1)+'",function($event){'+k(n)+"});"):e.dynamic?"":g(i.index,e);var t,n})+x(i.children,function(e){return R(e,i,t)})+w(i.index,e.index,n)}},S=function(e,t,n){switch(e.type){case"#if":return i(e.ifReference,t.index)+S(e.children[0],t,n);case"#comment":return i(e.commentElement,t.index);case"#text":return i(e.textElement,t.index);default:return i(e.index,t.index)}},E=function(t,e,n){switch(t.type){case"#text":var i=t.attributes[0];return i.dynamic?(u=t.index,c=i.value,"m.stc("+y(u)+","+c+");"):"";case"#if":var r=t.children[0];return"\n      if ("+k(t.attributes[0])+") {\n        if ("+y(t.ifState)+" === 0) {\n          "+E(r,e,n)+"\n        } else {\n          "+S(r,e,n)+"\n          "+t.ifCreate+"\n          "+b(t.ifState,"0")+"\n        }\n      }\n      ";case"#else":var a=t.children[0];return"\n      else {\n        if ("+y(t.ifState)+" === 1) {\n          "+E(a,e,n)+"\n        } else {\n          "+S(a,e,n)+"\n          "+t.ifCreate+"\n          "+b(t.ifState,"1")+"\n        }\n      }\n      ";default:return x(t.attributes,function(e){return"@"!==e.key[0]&&e.dynamic?g(t.index,e):""})+x(t.children,function(e){return E(e,t,n)})}var u,c},C=function(e){return t=function(e){for(var t=e.length,n=[],i={index:0,nextIndex:1,type:"#root",attributes:[],children:[],dependencies:n},r=[i],a=0;a<t;){var u=e[a];a="<"===u?"!"===e[a+1]&&"-"===e[a+2]&&"-"===e[a+3]?o(a+4,e,t):"/"===e[a+1]?f(a+2,e,t,r):c(a+1,e,t,r,n):"{"===u?p(a+1,e,t,r,n):m(a,e,t,r)}return i}(e),n=x(t.dependencies,function(e){return"var "+e+"=this.data."+e+";"}),new Function("return [function(m){this.m[0]=m;m=this.m;"+n+x(t.children,function(e){return R(e,t,t)})+"},function(){var m=this.m;"+n+x(t.children,function(e){return E(e,t,t)})+"},function(){var m=this.m;"+x(t.children,function(e){return S(e,t,t)})+"m=[m[0]];}];")();var t,n},q={},I=function(e){return document.createElement(e)},$=function(e){return document.createTextNode(e)},A=function(){return document.createComment("")},z=function(e,t,n){e.setAttribute(t,n)},O=function(e,t,n){e.addEventListener(t,n)},Z=function(e,t){e.textContent=t},_=function(e,t){t.appendChild(e)},j=function(e,t){t.removeChild(e)},N=function(e,t,n){n.insertBefore(e,t)},T=function(e){this.view[0](e),this.emit("create")},B=function(e,t){if(void 0!==e)if("object"==typeof e)for(var n in e)this.data[n]=e[n];else this.data[e]=t;if(!1===this.queued){this.queued=!0;var i=this;setTimeout(function(){i.view[1](),i.queued=!1,i.emit("update")},0)}},F=function(){this.view[2](),this.emit("destroy")},L=function(e,t){var n=this.data,i=n[e];void 0===i?n[e]=t:"function"==typeof i?n[e]=[i,t]:i.push(t)},M=function(e,t){if(void 0===t)this.data[e]=[];else{var n=this.data,i=n[e];"function"==typeof i?n[e]=void 0:i.splice(i.indexOf(t),1)}},D=function(e,t){var n=this.data[e];if(void 0!==n)if("function"==typeof n)n(t);else for(var i=0;i<n.length;i++)n[i](t)},G=function(a,u){return function(){var e,t=this;this.name=a,this.queued=!1,this.view=u.view.map(function(e){return e.bind(t)}),this.m=((e=[]).c=q,e.ce=I,e.ctn=$,e.cc=A,e.sa=z,e.ael=O,e.stc=Z,e.ac=_,e.rc=j,e.ib=N,e);var n=this.data=u.data(),i=u.actions;for(var r in i)n[r]=i[r].bind(t);this.create=T,this.update=B,this.destroy=F,this.on=L,this.off=M,this.emit=D}};function t(e){var t=e.root;"string"==typeof t&&(t=document.querySelector(t));var n=e.view;"string"==typeof n&&(e.view=C(n));var i=e.data;void 0===i?e.data=function(){return{}}:"object"==typeof i&&(e.data=function(){return i}),void 0===e.actions&&(e.actions={});var r=new(G("#m",e));return r.create(t),r.update(),r}return t.extend=function(e,t){var n=t.view;"string"==typeof n&&(t.view=C(n)),void 0===t.data&&(t.data=function(){return{}}),void 0===t.actions&&(t.actions={}),q[e]=G(e,t)},t.compile=C,t.config=e,t});