/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var t=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,r=["NaN","event","false","in","m","null","this","true","typeof","undefined"],d=function(e,n){var i=!1;return{expression:e=e.replace(t,function(e,t){return void 0===t||-1!==r.indexOf(t)||"$"===t[0]?e:(i=!0,-1===n.indexOf(t)&&n.push(t),"data."+t)}),dynamic:i}},e={silent:!0},v=/^\s+$/,c=function(e,t,n,i,r){for(;e<n;){var a=t[e];if("/"===a||">"===a)break;if(v.test(a))e+=1;else{for(var u="",f="",o=!1;e<n;){if("/"===(a=t[e])||">"===a||v.test(a)){f="";break}if("="===a){e+=1;break}u+=a,e+=1}if(0===f.length){var s=void 0;for('"'===(a=t[e])||"'"===a?(s=a,e+=1):"{"===a?(s="}",o=!0,e+=1):s=v;e<n&&"/"!==(a=t[e])&&">"!==a;){if("object"==typeof s&&s.test(a)||a===s){e+=1;break}f+=a,e+=1}}var c=d(f,i);r.push({key:u,value:c.expression,expression:o,dynamic:o&&c.dynamic})}}return e},f=function(e,t,n,i,r){for(var a={type:"",attributes:[],children:[]};e<n;){var u=t[e];if(">"===u){var f=a.attributes;"#"!==a.type[0]&&(a.index=i[0].nextIndex++),i.push(a);for(var o=0;o<f.length;){var s=f[o];"#"===s.key[0]?(a={type:s.key,attributes:[{key:"",value:s.value,expression:s.expression,dynamic:s.dynamic}],children:[a]},f.splice(o,1)):o+=1}i[i.length-2].children.push(a),e+=1;break}if("/"===u&&">"===t[e+1]){"#"!==a.type[0]&&(a.index=i[0].nextIndex++),i[i.length-1].children.push(a),e+=2;break}v.test(u)&&(e+=1)||"="===u?e=c(e,t,n,r,a.attributes):(a.type+=u,e+=1)}return e},o=function(e,t,n,i){for(;e<n;e++){var r=t[e];if(">"===r){e+=1;break}r}var a=i.pop();return a.type,e},s=function(e,t,n){for(;e<n;){var i=t[e],r=t[e+1],a=t[e+2];if("<"===i&&"!"===r&&"-"===a&&"-"===t[e+3])e=s(e+4,t,n);else{if("-"===i&&"-"===r&&">"===a){e+=3;break}e+=1}}return e},u=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,l={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},h=function(e,t,n,i){for(var r="";e<n;e++){var a=t[e];if("<"===a||"{"===a)break;r+=a}return v.test(r)||i[i.length-1].children.push({type:"#text",attributes:[{key:"",value:r.replace(u,function(e){return l[e]}),expression:!1,dynamic:!1}],children:[]}),e},m=function(e,t,n,i,r){for(var a="";e<n;e++){var u=t[e];if("}"===u){e+=1;break}a+=u}var f=d(a,r);return i[i.length-1].children.push({type:"#text",attributes:[{key:"",value:f.expression,expression:!0,dynamic:f.dynamic}],children:[]}),e},y=function(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i]);return n},b=function(e){return"m["+e+"]"},g=function(e,t){return b(e)+"="+t},k=function(e){return e.expression?e.value:'"'+e.value+'"'},w=function(e,t){return"m.sa("+b(e)+',"'+t.key+'",'+k(t)+");"},i=function(e,t){return"m.rc("+b(e)+","+b(t)+");"},C=function(e,t,n){switch(e.type){case"#if":return i(e.ifReference,t.index)+"if("+b(e.ifState)+"===1){"+b(e.elseDestroy)+"();}";case"#else":return"else{"+b(e.ifDestroy)+"();}";case"#comment":return i(e.commentElement,t.index);case"#text":return i(e.textElement,t.index);default:return i(e.index,t.index)}},I=function(e,t,n){return void 0===n?(a=t,"m.ac("+b(e)+","+b(a)+");"):(i=n,r=t,"m.ib("+b(e)+","+b(i)+","+b(r)+");");var i,r,a},S=function(i,e,t,n){switch(i.type){case"#if":var r=e.children,a=r.indexOf(i)+1,u=r[a];i.ifReference=t.nextIndex++,i.ifState=t.nextIndex++,i.ifCreate=t.nextIndex++,i.elseDestroy=t.nextIndex++,void 0!==u&&"#else"===u.type?(u.ifState=i.ifState,u.elseCreate=t.nextIndex++,u.ifDestroy=t.nextIndex++):(u={type:"#else",attributes:[],children:[],ifState:i.ifState,elseCreate:t.nextIndex++,ifDestroy:t.nextIndex++},r.splice(a,0,u));for(var f="",o="",s="",c="",d=i.children,v=0;v<d.length;v++){var l=d[v];f+=S(l,e,t,i.ifReference),o+=C(l,e)}for(var h=u.children,m=0;m<h.length;m++){var x=h[m];s+=S(x,e,t,i.ifReference),c+=C(x,e)}return g(i.ifReference,"m.cc();")+I(i.ifReference,e.index,n)+g(i.ifCreate,"function(){"+f+"};")+g(u.ifDestroy,"function(){"+o+"};")+g(u.elseCreate,"function(){"+s+"};")+g(i.elseDestroy,"function(){"+c+"};")+"if("+k(i.attributes[0])+"){"+b(i.ifCreate)+"();"+g(i.ifState,"0;")+"}";case"#else":return"else{"+b(i.elseCreate)+"();"+g(i.ifState,"1;")+"}";case"#comment":return i.commentElement=t.nextIndex++,g(i.commentElement,"m.cc();")+I(i.commentElement,e.index,n);case"#text":var p=i.attributes[0];return i.textElement=t.nextIndex++,g(i.textElement,"m.ctn("+k(p)+");")+I(i.textElement,e.index,n);default:return g(i.index,'m.ce("'+i.type+'");')+y(i.attributes,function(e){return"@"===e.key[0]?(t=i.index,n=e,"m.ael("+b(t)+',"'+n.key.substring(1)+'",function($event){'+k(n)+"});"):w(i.index,e);var t,n})+y(i.children,function(e){return S(e,i,t)})+I(i.index,e.index,n)}},x=function(t,n,i){switch(t.type){case"#if":return"if("+k(t.attributes[0])+"){if("+b(t.ifState)+"===0){"+y(t.children,function(e){return x(e,n,i)})+"}else{"+b(t.elseDestroy)+"();"+b(t.ifCreate)+"();"+g(t.ifState,"0;")+"}}";case"#else":return"else{if("+b(t.ifState)+"===1){"+y(t.children,function(e){return x(e,n,i)})+"}else{"+b(t.ifDestroy)+"();"+b(t.elseCreate)+"();"+g(t.ifState,"1;")+"}}";case"#text":var e=t.attributes[0];return e.dynamic?(r=t.textElement,a=e.value,"m.stc("+b(r)+","+a+");"):"";default:return y(t.attributes,function(e){return"@"!==e.key[0]&&e.dynamic?w(t.index,e):""})+y(t.children,function(e){return x(e,t,i)})}var r,a},a=function(e){return t=function(e){for(var t=e.length,n=[],i={index:0,nextIndex:1,type:"#root",attributes:[],children:[],dependencies:n},r=[i],a=0;a<t;){var u=e[a];a="<"===u?"!"===e[a+1]&&"-"===e[a+2]&&"-"===e[a+3]?s(a+4,e,t):"/"===e[a+1]?o(a+2,e,t,r):f(a+1,e,t,r,n):"{"===u?m(a+1,e,t,r,n):h(a,e,t,r)}return i}(e),new Function("return [function(m){this.m[0]=m;m=this.m;var data=this.data;"+y(t.children,function(e){return S(e,t,t)})+"},function(){var m=this.m;var data=this.data;"+y(t.children,function(e){return x(e,t,t)})+"},function(){var m=this.m;"+y(t.children,function(e){return C(e,t)})+"this.m=[m[0]];}];")();var t},p={},E=function(e){return document.createElement(e)},D=function(e){return document.createTextNode(e)},q=function(){return document.createComment("")},$=function(e,t,n){e.setAttribute(t,n)},R=function(e,t,n){e.addEventListener(t,n)},A=function(e,t){e.textContent=t},z=function(e,t){t.appendChild(e)},O=function(e,t){t.removeChild(e)},Z=function(e,t,n){n.insertBefore(e,t)},_=function(e){this.view[0](e),this.emit("create")},j=function(e,t){if(void 0!==e)if("object"==typeof e)for(var n in e)this.data[n]=e[n];else this.data[e]=t;if(!1===this.queued){this.queued=!0;var i=this;setTimeout(function(){i.view[1](),i.queued=!1,i.emit("update")},0)}},N=function(){this.view[2](),this.emit("destroy")},T=function(e,t){var n=this.events,i=n[e];void 0===i?n[e]=t:"function"==typeof i?n[e]=[i,t]:i.push(t)},B=function(e,t){if(void 0===e)this.events={};else if(void 0===t)this.events[e]=[];else{var n=this.events,i=n[e];"function"==typeof i?n[e]=void 0:i.splice(i.indexOf(t),1)}},F=function(e,t){var n=this.events[e];if(void 0!==n)if("function"==typeof n)n(t);else for(var i=0;i<n.length;i++)n[i](t)},L=function(s,c){return function(){var e,t=this;this.name=s,this.queued=!1,this.view=c.view.map(function(e){return e.bind(t)}),this.m=((e=[]).c=p,e.ce=E,e.ctn=D,e.cc=q,e.sa=$,e.ael=R,e.stc=A,e.ac=z,e.rc=O,e.ib=Z,e);var n=this.data=c.data();for(var i in n){var r=n[i];"function"==typeof r&&(n[i]=r.bind(t))}var a=this.events=c.events;for(var u in a){var f=a[u];if("function"==typeof f)a[u]=f.bind(t);else for(var o=0;o<f.length;o++)f[o]=f[o].bind(t)}this.create=_,this.update=j,this.destroy=N,this.on=T,this.off=B,this.emit=F}};function n(e){var t=e.root;"string"==typeof t&&(t=document.querySelector(t));var n=e.view;"string"==typeof n&&(e.view=a(n));var i=e.data;void 0===i?e.data=function(){return{}}:"object"==typeof i&&(e.data=function(){return i}),void 0===e.events&&(e.events={});var r=new(L("",e));return r.create(t),r}return n.extend=function(e,t){var n=t.view;"string"==typeof n&&(t.view=a(n)),void 0===t.data&&(t.data=function(){return{}}),void 0===t.events&&(t.events={}),p[e]=L(e,t)},n.compile=a,n.config=e,n});