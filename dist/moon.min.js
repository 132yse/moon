/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(e,t){"undefined"==typeof module?e.Moon=t():module.exports=t()}(this,function(){"use strict";var t=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,r=["NaN","event","false","in","m","null","this","true","typeof","undefined"],v=function(e,n){var i=!1;return{expression:e=e.replace(t,function(e,t){return void 0===t||-1!==r.indexOf(t)||"$"===t[0]?e:(i=!0,-1===n.indexOf(t)&&n.push(t),"data."+t)}),dynamic:i}},e={silent:!0},l=/^\s+$/,h=/[\s/>]/,c=function(e,t,n,i,r){for(;e<n;){var a=t[e];if("/"===a||">"===a)break;if(l.test(a))e+=1;else{for(var f="",u=void 0,o=!1;e<n;){if("/"===(a=t[e])||">"===a||l.test(a)){u="";break}if("="===a){e+=1;break}f+=a,e+=1}if(void 0===u){var s=void 0;for(u="",'"'===(a=t[e])||"'"===a?(s=a,e+=1):"{"===a?(s="}",o=!0,e+=1):s=h;e<n;){if(a=t[e],"object"==typeof s&&s.test(a)||a===s){e+=1;break}u+=a,e+=1}}var c=!1;if(o){var d=v(u,i);u=d.expression,c=d.dynamic}r.push({key:f,value:u,expression:o,dynamic:c})}}return e},u=function(e,t,n,i,r){for(var a={type:"",attributes:[],children:[]};e<n;){var f=t[e];if(">"===f){var u=a.attributes;"#"!==a.type[0]&&(a.index=i[0].nextIndex++),i.push(a);for(var o=0;o<u.length;){var s=u[o];"#"===s.key[0]?(a={type:s.key,attributes:[{key:"",value:s.value,expression:s.expression,dynamic:s.dynamic}],children:[a]},u.splice(o,1)):o+=1}i[i.length-2].children.push(a),e+=1;break}if("/"===f&&">"===t[e+1]){"#"!==a.type[0]&&(a.index=i[0].nextIndex++),i[i.length-1].children.push(a),e+=2;break}l.test(f)&&(e+=1)||"="===f?e=c(e,t,n,r,a.attributes):(a.type+=f,e+=1)}return e},o=function(e,t,n,i){for(;e<n;e++){var r=t[e];if(">"===r){e+=1;break}r}var a=i.pop();return a.type,e},s=function(e,t,n){for(;e<n;){var i=t[e],r=t[e+1],a=t[e+2];if("<"===i&&"!"===r&&"-"===a&&"-"===t[e+3])e=s(e+4,t,n);else{if("-"===i&&"-"===r&&">"===a){e+=3;break}e+=1}}return e},f=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,d={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},m=function(e,t,n,i){for(var r="";e<n;e++){var a=t[e];if("<"===a||"{"===a)break;r+=a}return l.test(r)||i[i.length-1].children.push({type:"#text",attributes:[{key:"",value:r.replace(f,function(e){return d[e]}),expression:!1,dynamic:!1}],children:[]}),e},p=function(e,t,n,i,r){for(var a="";e<n;e++){var f=t[e];if("}"===f){e+=1;break}a+=f}var u=v(a,r);return i[i.length-1].children.push({type:"#text",attributes:[{key:"",value:u.expression,expression:!0,dynamic:u.dynamic}],children:[]}),e},x=function(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i]);return n},y=function(e){return"m"+e},b=function(e,t){return y(e)+"="+t},g=function(e){return e.expression?e.value:'"'+e.value+'"'},k=function(e,t){return"m.sa("+y(e)+',"'+t.key+'",'+g(t)+");"},i=function(e,t){return"m.rc("+y(e)+","+y(t)+");"},w=function(e,t,n){switch(e.type){case"#if":return i(e.ifReference,t.index)+y(e.ifState)+"();";case"#elseif":case"#else":return"";case"#comment":return i(e.commentElement,t.index);case"#text":return i(e.textElement,t.index);default:return i(e.index,t.index)}},S=function(e,t,n){return void 0===n?(a=t,"m.ac("+y(e)+","+y(a)+");"):(i=n,r=t,"m.ib("+y(e)+","+y(i)+","+y(r)+");");var i,r,a},C=function(i,e,t,n){switch(i.type){case"#if":var r=t.nextIndex++;i.ifReference=t.nextIndex++;for(var a="",f=e.children,u=0;u<f.length;u++){var o=f[u];if("#if"===o.type||"#elseif"===o.type||"#else"===o.type){for(var s=o.children,c="",d="",v=0;v<s.length;v++){var l=s[v];c+=C(l,e,t,i.ifReference),d+=w(l,e)}o.ifState=r,o.ifCreate=t.nextIndex++,o.ifDestroy=t.nextIndex++,a+=b(o.ifCreate,"function(){"+c+"};")+b(o.ifDestroy,"function(){"+d+"};")}}return b(i.ifReference,"m.cc();")+S(i.ifReference,e.index,n)+a+"if("+g(i.attributes[0])+"){"+y(i.ifCreate)+"();"+b(i.ifState,y(i.ifDestroy))+"}";case"#elseif":return"else if("+g(i.attributes[0])+"){"+y(i.ifCreate)+"();"+b(i.ifState,y(i.ifDestroy))+"}";case"#else":return"else{"+y(i.ifCreate)+"();"+b(i.ifState,y(i.ifDestroy))+"}";case"#comment":return i.commentElement=t.nextIndex++,b(i.commentElement,"m.cc();")+S(i.commentElement,e.index,n);case"#text":var h=i.attributes[0];return i.textElement=t.nextIndex++,b(i.textElement,"m.ctn("+g(h)+");")+S(i.textElement,e.index,n);default:return b(i.index,'m.ce("'+i.type+'");')+x(i.attributes,function(e){return"@"===e.key[0]?(t=i.index,n=e,"m.ael("+y(t)+',"'+n.key.substring(1)+'",function($event){'+g(n)+"});"):k(i.index,e);var t,n})+x(i.children,function(e){return C(e,i,t)})+S(i.index,e.index,n)}},D=function(t,n,i){switch(t.type){case"#if":return"if("+g(t.attributes[0])+"){if("+y(t.ifState)+"==="+y(t.ifDestroy)+"){"+x(t.children,function(e){return D(e,n,i)})+"}else{"+y(t.ifState)+"();"+y(t.ifCreate)+"();"+b(t.ifState,y(t.ifDestroy))+"}}";case"#elseif":return"else if("+g(t.attributes[0])+"){if("+y(t.ifState)+"==="+y(t.ifDestroy)+"){"+x(t.children,function(e){return D(e,n,i)})+"}else{"+y(t.ifState)+"();"+y(t.ifCreate)+"();"+b(t.ifState,y(t.ifDestroy))+"}}";case"#else":return"else{if("+y(t.ifState)+"==="+y(t.ifDestroy)+"){"+x(t.children,function(e){return D(e,n,i)})+"}else{"+y(t.ifState)+"();"+y(t.ifCreate)+"();"+b(t.ifState,y(t.ifDestroy))+"}}";case"#text":var e=t.attributes[0];return e.dynamic?(r=t.textElement,a=e.value,"m.stc("+y(r)+","+a+");"):"";default:return x(t.attributes,function(e){return"@"!==e.key[0]&&e.dynamic?k(t.index,e):""})+x(t.children,function(e){return D(e,t,i)})}var r,a},a=function(e){return function(t){for(var e=x(t.children,function(e){return C(e,t,t)}),n=x(t.children,function(e){return D(e,t,t)}),i=x(t.children,function(e){return w(e,t)}),r="var m0",a=1;a<t.nextIndex;a++)r+=",m"+a;return new Function(r+";return [function(m){m0=m;m=this.m;var data=this.data;"+e+"},function(){var m=this.m;var data=this.data;"+n+"},function(){var m=this.m;"+i+"}];")}(function(e){for(var t=e.length,n=[],i={index:0,nextIndex:1,type:"#root",attributes:[],children:[],dependencies:n},r=[i],a=0;a<t;){var f=e[a];a="<"===f?"!"===e[a+1]&&"-"===e[a+2]&&"-"===e[a+3]?s(a+4,e,t):"/"===e[a+1]?o(a+2,e,t,r):u(a+1,e,t,r,n):"{"===f?p(a+1,e,t,r,n):m(a,e,t,r)}return i}(e))},E={},I=function(e){return document.createElement(e)},q=function(e){return document.createTextNode(e)},$=function(){return document.createComment("")},A=function(e,t,n){e.setAttribute(t,n)},R=function(e,t,n){e.addEventListener(t,n)},z=function(e,t){e.textContent=t},Z=function(e,t){t.appendChild(e)},_=function(e,t){t.removeChild(e)},j=function(e,t,n){n.insertBefore(e,t)},N=function(e){this.view[0](e),this.emit("create")},O=function(e,t){if(void 0!==e)if("object"==typeof e)for(var n in e)this.data[n]=e[n];else this.data[e]=t;if(!1===this.queued){this.queued=!0;var i=this;setTimeout(function(){i.view[1](),i.queued=!1,i.emit("update")},0)}},T=function(){this.view[2](),this.emit("destroy")},B=function(e,t){var n=this.events,i=n[e];void 0===i?n[e]=t:"function"==typeof i?n[e]=[i,t]:i.push(t)},F=function(e,t){if(void 0===e)this.events={};else if(void 0===t)this.events[e]=[];else{var n=this.events,i=n[e];"function"==typeof i?n[e]=void 0:i.splice(i.indexOf(t),1)}},L=function(e,t){var n=this.events[e];if(void 0!==n)if("function"==typeof n)n(t);else for(var i=0;i<n.length;i++)n[i](t)},M=function(o,s){return function(){var t=this;this.name=o,this.queued=!1,this.view=s.view.map(function(e){return e.bind(t)}),this.m={c:E,ce:I,ctn:q,cc:$,sa:A,ael:R,stc:z,ac:Z,rc:_,ib:j};var e=this.data=s.data();for(var n in e){var i=e[n];"function"==typeof i&&(e[n]=i.bind(t))}var r=this.events=s.events;for(var a in r){var f=r[a];if("function"==typeof f)r[a]=f.bind(t);else for(var u=0;u<f.length;u++)f[u]=f[u].bind(t)}this.create=N,this.update=O,this.destroy=T,this.on=B,this.off=F,this.emit=L}};function n(e){var t=e.root;"string"==typeof t&&(t=document.querySelector(t));var n=e.view;"string"==typeof n&&(e.view=a(n)());var i=e.data;void 0===i?e.data=function(){return{}}:"object"==typeof i&&(e.data=function(){return i}),void 0===e.events&&(e.events={});var r=new(M("",e));return r.create(t),r}return n.extend=function(e,t){var n=t.view;"string"==typeof n&&(t.view=a(n)()),void 0===t.data&&(t.data=function(){return{}}),void 0===t.events&&(t.events={}),E[e]=M(e,t)},n.compile=a,n.config=e,n});