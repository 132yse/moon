/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(t,e){"undefined"==typeof module?t.Moon=e():module.exports=e()}(this,function(){"use strict";var a=function(t,e,n){for(;t<n;){var i=e[t],r=e[t+1],u=e[t+2];if("<"===i&&"!"===r&&"-"===u&&"-"===e[t+3])t=a(t+4,e,n);else{if("-"===i&&"-"===r&&">"===u){t+=3;break}t+=1}}return t},s=function(t,n){return t.reduce(function(t,e){return t+n(e)},"")},v=function(t,e){return"m["+t+"]="+e},m=function(t){return t.expression?t.value:'"'+t.value+'"'},h=function(t,e){return"m.sa(m["+t+'],"'+e.key+'",'+m(e)+");"},l={"m-on":{order:0,create:function(t,e,n,i){return[t+(r=i.index,u=n.argument,o="function($event){"+m(n)+"}","m.ael(m["+r+'],"'+u+'",'+o+");"),e];var r,u,o},update:function(t){return t},destroy:function(t){return t}},"m-if":{}},u=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,o=["NaN","event","false","in","m","null","this","true","typeof","undefined"],p=function(t,e){for(var n,i=!1;null!==(n=u.exec(t));){var r=n[1];void 0!==r&&-1===o.indexOf(r)&&"$"!==r[0]&&(i=!0,-1===e.indexOf(r)&&e.push(r))}return i},t={silent:!0},x=/\s+/,d=function(t,e){e[e.length-1].children.push(t)},y=function(t){return t.sort(function(t,e){return l[t.key].order-l[e.key].order})},b=function(t,e,n,i,r,u){for(;t<n;){var o=e[t];if("/"===o||">"===o)break;if(x.test(o))t+=1;else{for(var a="",c="",f="",d=!1;t<n;){if("/"===(o=e[t])||">"===o||x.test(o)){f=a;break}if("="===o){t+=1;break}":"===o&&"m"===a[0]&&"-"===a[1]?(c+=e[t+1],t+=2):(0!==c.length?c+=o:a+=o,t+=1)}if(0===f.length){var s=void 0;for('"'===(o=e[t])||"'"===o?(s=o,t+=1):"{"===o?(s="}",d=!0,t+=1):s=x;t<n&&"/"!==(o=e[t])&&">"!==o;){if("object"==typeof s&&s.test(o)||o===s){t+=1;break}f+=o,t+=1}}("m"===a[0]&&"-"===a[1]?r:i).push({key:a,value:f,argument:c,expression:d,dynamic:d&&p(f,u)})}}return t},c=function(t,e,n,i,r){for(var u="",o=[],a=[];t<n;){var c=e[t];if(">"===c){var f={index:i[0].nextIndex++,type:u,attributes:o,directives:y(a),children:[]};d(f,i),i.push(f),t+=1;break}if("/"===c&&">"===e[t+1]){d({index:i[0].nextIndex++,type:u,attributes:o,directives:y(a),children:[]},i),t+=2;break}x.test(c)?t=b(t+1,e,n,o=[],a=[],r):(u+=c,t+=1)}return t},f=function(t,e,n,i){for(;t<n;t++){var r=e[t];if(">"===r){t+=1;break}r}var u=i.pop();return u.type,t},k=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,g={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},w=function(t,e,n,i){for(var r="";t<n;t++){var u=e[t];if("<"===u||"{"===u)break;r+=u}return x.test(r)||d({index:i[0].nextIndex++,type:"m-text",attributes:[{key:"content",value:r.replace(k,function(t){return g[t]}),argument:"",expression:!1,dynamic:!1}],directives:[],children:[]},i),t},q=function(t,e,n,i,r){for(var u="";t<n;t++){var o=e[t];if("}"===o){t+=1;break}u+=o}return d({index:i[0].nextIndex++,type:"m-text",attributes:[{key:"content",value:u,argument:"",expression:!0,dynamic:p(u,r)}],directives:[],children:[]},i),t},$=function(e,t,n){var i,r,u,o=(r=e.index,u=t.index,"m.ac(m["+r+"],m["+u+"]);");switch(e.type){case"m-comment":i=v(e.index,"m.cc();");break;case"m-text":i=v(e.index,"m.ctn("+m(e.attributes[0])+");");break;default:i=v(e.index,'m.ce("'+e.type+'");')+s(e.attributes,function(t){return h(e.index,t)})+s(e.children,function(t){return $(t,e,n)})}for(var a=e.directives,c=0;c<a.length;c++){var f=a[c],d=l[f.key].create(i,o,f,e,t,n);i=d[0],o=d[1]}return i+o},A=function(e,t,n){var i,r,u;switch(e.type){case"m-comment":i="";break;case"m-text":var o=e.attributes[0];i=o.dynamic?(r=e.index,u=o.value,"m.stc(m["+r+"],"+u+");"):"";break;default:i=s(e.attributes,function(t){return t.dynamic?h(e.index,t):""})+s(e.children,function(t){return A(t,e,n)})}for(var a=e.directives,c=0;c<a.length;c++){var f=a[c];i=l[f.key].update(i,f,e,t,n)}return i},e=function(e){var t=s(e.dependencies,function(t){return"var "+t+"=this.data."+t+";"});return new Function("return [function(m){this.m[0]=m;m=this.m;"+t+s(e.children,function(t){return $(t,e,e)})+"},function(){var m=this.m;"+t+s(e.children,function(t){return A(t,e,e)})+"},function(){var m=this.m;"+s(e.children,function(t){return function(t,e,n){for(var i,r,u=t.directives,o=(i=t.index,r=e.index,"m.rc(m["+i+"],m["+r+"]);"),a=0;a<u.length;a++){var c=u[a];o=l[c.key].destroy(o,c,t,e,n)}return o}(t,e,e)})+"m=[m[0]];}];")()},I=function(t){return e(function(t){for(var e=t.length,n=[],i={index:0,nextIndex:1,type:"m-root",attributes:[],directives:[],children:[],dependencies:n},r=[i],u=0;u<e;){var o=t[u];u="<"===o?"!"===t[u+1]&&"-"===t[u+2]&&"-"===t[u+3]?a(u+4,t,e):"/"===t[u+1]?f(u+2,t,e,r):c(u+1,t,e,r,n):"{"===o?q(u+1,t,e,r,n):w(u,t,e,r)}return i}(t))},z={},C=function(t){return document.createElement(t)},N=function(t){return document.createTextNode(t)},Z=function(){return document.createComment("")},_=function(t,e){e.appendChild(t)},j=function(t,e){e.removeChild(t)},O=function(t,e,n){n.insertNode(t,e)},E=function(t,e,n){t.addEventListener(e,n)},T=function(t,e,n){t.setAttribute(e,n)},F=function(t,e){t.textContent=e},L=function(t){this.view[0](t),this.emit("created")},M=function(){if(!1===this.queued){this.queued=!0;var t=this;setTimeout(function(){t.view[1](),t.queued=!1,t.emit("updated")},0)}},S=function(){this.view[2](),this.emit("destroyed")},B=function(t,e){if("object"==typeof t)for(var n in t)this.set(n,t[n]);else this.data[t]=e,this.update()},D=function(t,e){var n=this.data,i=n[t];void 0===i?n[t]=e:"function"==typeof i?n[t]=[i,e]:i.push(e)},G=function(t,e){if(void 0===e)this.data[t]=[];else{var n=this.data,i=n[t];"function"==typeof i?n[t]=void 0:i.splice(i.indexOf(e),1)}},H=function(t,e){var n=this.data[t];if(void 0!==n)if("function"==typeof n)n(e);else for(var i=0;i<n.length;i++)n[i](e)},J=function(u,o){return function(){var t,e=this;this.name=u,this.view=o.view.map(function(t){return t.bind(e)}),this.m=((t=[]).c=z,t.ce=C,t.ctn=N,t.cc=Z,t.ac=_,t.rc=j,t.in=O,t.ael=E,t.sa=T,t.stc=F,t);var n=this.data=o.data(),i=o.actions;for(var r in i)n[r]=i[r].bind(e);this.queued=!1,this.create=L,this.update=M,this.destroy=S,this.set=B,this.on=D,this.off=G,this.emit=H}};function n(t){var e=t.root;"string"==typeof e&&(e=document.querySelector(e));var n=t.view;"string"==typeof n&&(t.view=I(n));var i=t.data;void 0===i?t.data=function(){return{}}:"object"==typeof i&&(t.data=function(){return i}),void 0===t.actions&&(t.actions={});var r=new(J("m-instance",t));return r.create(e),r}return n.extend=function(t,e){var n=e.view;"string"==typeof n&&(e.view=I(n)),void 0===e.data&&(e.data=function(){return{}}),void 0===e.actions&&(e.actions={}),z[t]=J(t,e)},n.compile=I,n.config=t,n});