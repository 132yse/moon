/**
 * Moon v1.0.0-alpha
 * Copyright 2016-2018 Kabir Shah
 * Released under the MIT License
 * https://kbrsh.github.io/moon
 */
!function(t,e){"undefined"==typeof module?t.Moon=e():module.exports=e()}(this,function(){"use strict";var o=function(t,e,n){for(;t<n;){var i=e[t],r=e[t+1],u=e[t+2];if("<"===i&&"!"===r&&"-"===u&&"-"===e[t+3])t=o(t+4,e,n);else{if("-"===i&&"-"===r&&">"===u){t+=3;break}t+=1}}return t},u=/"[^"]*"|'[^']*'|\d+[a-zA-Z$_]\w*|\.[a-zA-Z$_]\w*|[a-zA-Z$_]\w*:|([a-zA-Z$_]\w*)/g,a=["NaN","event","false","in","m","null","this","true","typeof","undefined"],v=function(t,e){for(var n,i=!1;null!==(n=u.exec(t));){var r=n[1];void 0!==r&&-1===a.indexOf(r)&&(e.push(r),i=!0)}return i},t={silent:!0},d=function(t,e){e[e.length-1].children.push(t)},m=/\s/,s=function(t,e,n,i,r,u){for(;t<n;){var a=e[t];if("/"===a||">"===a)break;if(m.test(a))t+=1;else{for(var o="",c="",f="",d=!1;t<n;){if("/"===(a=e[t])||">"===a||m.test(a)){f=o;break}if("="===a){t+=1;break}":"===a&&"m"===o[0]&&"-"===o[1]?(c+=e[t+1],t+=2):(0!==c.length?c+=a:o+=a,t+=1)}if(0===f.length){var s=void 0;for('"'===(a=e[t])||"'"===a?(s=a,t+=1):"{"===a?(s="}",d=!0,t+=1):s=m;t<n&&"/"!==(a=e[t])&&">"!==a;){if("object"==typeof s&&s.test(a)||a===s){t+=1;break}f+=a,t+=1}}("m"===o[0]&&"-"===o[1]?r:i).push({key:o,value:f,argument:c,expression:d,dynamic:d&&v(f,u)})}}return t},c=function(t,e,n,i,r){for(var u="",a=[],o=[];t<n;){var c=e[t];if(">"===c){var f={index:i[0].index++,type:u,attributes:a,directives:o,children:[]};d(f,i),i.push(f),t+=1;break}if("/"===c&&">"===e[t+1]){d({index:i[0].index++,type:u,attributes:a,directives:o,children:[]},i),t+=2;break}m.test(c)?t=s(t+1,e,n,a=[],o=[],r):(u+=c,t+=1)}return t},f=function(t,e,n,i){for(;t<n;t++){var r=e[t];if(">"===r){t+=1;break}r}var u=i.pop();return u.type,t},p=/(?:(?:&(?:amp|gt|lt|nbsp|quot);)|"|\\|\n)/g,h={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'\\"',"\\":"\\\\",'"':'\\"',"\n":"\\n"},l=function(t,e,n,i){for(var r="";t<n;t++){var u=e[t];if("<"===u||"{"===u)break;r+=u}return d({index:i[0].index++,type:"m-text",content:r.replace(p,function(t){return h[t]})},i),t},x=function(t,e,n,i,r){for(var u="";t<n;t++){var a=e[t];if("}"===a){t+=1;break}u+=a}return d({index:i[0].index++,type:"m-expression",content:u,dynamic:v(u,r)},i),t},y=function(t,n){return t.reduce(function(t,e){return t+n(e)},"")},b=function(t){return t.expression?t.value:'"'+t.value+'"'},g={"m-on":{create:function(t,e,n,i,r){return e.on=r.index++,t+"m.cae(m["+n.index+'],"'+e.argument+'",function(event){m['+e.on+"](event);});"},update:function(t,e){return t+"m["+e.on+"]=function(event){"+b(e)+";};"}}},w=function(e,n,i){switch(e.type){case"m-fragment":return y(e.children,function(t){return w(t,n,i)});case"m-expression":return"m["+e.index+']=m.ct("");m.ca(m['+e.index+"],"+n+");";case"m-text":return"m["+e.index+']=m.ct("'+e.content+'");m.ca(m['+e.index+"],"+n+");";default:for(var t=e.directives,r="m["+e.index+']=m.ce("'+e.type+'");'+y(e.attributes,function(t){return t.dynamic?"":"m["+e.index+'].setAttribute("'+t.key+'",'+b(t)+");"})+"m.ca(m["+e.index+"], "+n+");"+y(e.children,function(t){return w(t,"m["+e.index+"]",i)}),u=0;u<t.length;u++){var a=t[u],o=g[a.key];r=o.create(r,a,e,n,i),a.dynamic||(r+=o.update("",a,e,n,i))}return r}},k=function(e,n){switch(e.type){case"m-expression":return e.dynamic?"m.ut(m["+e.index+"],"+e.content+");":"";case"m-text":return"";default:for(var t=e.directives,i=y(e.attributes,function(t){return t.dynamic?"m["+e.index+'].setAttribute("'+t.key+'",'+t.value+");":""})+y(e.children,function(t){return k(t,n)}),r=0;r<t.length;r++){var u=t[r];u.dynamic&&(i=g[u.key].update(i,u,e,parent,n))}return i}},q=function(t){return e=function(t){for(var e=t.length,n=[],i={index:0,type:"m-fragment",attributes:[],directives:[],children:[],dependencies:n},r=[i],u=0;u<e;){var a=t[u];u="<"===a?"!"===t[u+1]&&"-"===t[u+2]&&"-"===t[u+3]?o(u+4,t,e):"/"===t[u+1]?f(u+2,t,e,r):c(u+1,t,e,r,n):"{"===a?x(u+1,t,e,r,n):l(u,t,e,r)}return i}(t),new Function("return [function(root){var m=this.m;"+w(e,"root",e)+"},function(){var m=this.m;"+y(e.dependencies,function(t){return"var "+t+"=this.data."+t+";"})+k(e,e)+"}]")();var e},A={},z=function(t){return document.createElement(t)},Z=function(t){return document.createTextNode(t)},$=function(t,e,n){t.addEventListener(e,n)},_=function(t,e){e.appendChild(t)},j=function(t,e){t.textContent=e},N=function(){if(!1===this.queued){this.queued=!0;var t=this;setTimeout(function(){t.view[1](),t.queued=!1,t.emit("updated")},0)}},C=function(t,e){if("object"==typeof t)for(var n in t)this.set(n,t[n]);else this.data[t]=e,this.build()},E=function(t,e){var n=this.data,i=n[t];void 0===i?n[t]=e:"function"==typeof i?n[t]=[i,e]:i.push(e)},O=function(t,e){if(void 0===e)this.data[t]=[];else{var n=this.data,i=n[t];"function"==typeof i?n[t]=void 0:i.splice(i.indexOf(e),1)}},T=function(t,e){var n=this.data[t];if(void 0!==n)if("function"==typeof n)n(e);else for(var i=0;i<n.length;i++)n[i](e)},F=function(u,a){return function(){var t,e=this;this.name=u,this.view=a.view.map(function(t){return t.bind(e)}),this.m=((t=[]).c=A,t.ce=z,t.ct=Z,t.cae=$,t.ca=_,t.ut=j,t);var n=this.data=a.data(),i=a.actions;for(var r in i)n[r]=i[r].bind(e);this.queued=!1,this.build=N,this.set=C,this.on=E,this.off=O,this.emit=T}};function e(t){var e=t.root;"string"==typeof e&&(e=document.querySelector(e));var n=t.view;"string"==typeof n&&(t.view=q(n));var i=t.data;void 0===i?t.data=function(){return{}}:"object"==typeof i&&(t.data=function(){return i}),void 0===t.actions&&(t.actions={});var r=new(F("m-root",t));return r.view[0](e),r.view[1](),r.emit("created"),r}return e.extend=function(t,e){var n=e.view;"string"==typeof n&&(e.view=q(n)),void 0===e.data&&(e.data=function(){return{}}),void 0===e.actions&&(e.actions={}),A[t]=F(t,e)},e.compile=q,e.config=t,e});